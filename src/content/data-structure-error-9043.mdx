---
title: "The 'messages' parameter is expected to be of type 'array'. Please ensure the input follows the required data structure."
provider: "azure-openai"
provider_icon: "/file.svg"
solved: true
slug: "data-structure-error-9043"
---

## Raw Error Text

```text
{'userId': 'abcd123', 'messages': [{'role': 'system', 'content': 'Your sole purpose is to match requiredSheetsColumns columns with userSheetColumns columns carefully.'}, {'role': 'user', 'content': 'Below are 2 arrays, requiredColumns and userSheetColumns, Examine both arrays carefully, and the match the \'key\' of each object from requiredSheetsColumns array to \'label\' of each object of userSheetColumns array correctly. The label text should be exactly same as given. If a column appears to be a date field based on the \'example\' value in userSheetColumns, add a new key date_format suggesting the format of the date used (e.g., YYYY-MM-DD). If a match cannot be found, keep matched_column as null. "requiredSheetsColumns":[{"key":"staff_id","name":"Staff ID"},{"key":"full_name","name":"Full Name"},{"key":"date_of_birth","name":"Date of Birth"},{"key":"designation","name":"Designation"},{"key":"date_of_joining","name":"Date of Joining"},{"key":"last_working_day","name":"Last Working Day"},{"key":"phone_number","name":"Phone Number"},{"key":"personal_email","name":"Personal Email"},{"key":"business_email","name":"Business Email"},{"key":"employment_type","name":"Employment Type"},{"key":"exit_type","name":"Exit Type"},{"key":"exit_reason","name":"Exit Reason"},{"key":"eligible_for_rehire","name":"Eligible for Rehire"},{"key":"rm_name","name":"Reporting Manager\'s Name"},{"key":"rm_designation","name":"Reporting Manager\'s Designation"},{"key":"rm_email","name":"Reporting Manager\'s Email"},{"key":"rm_phone","name":"Reporting Manager\'s Phone"},{"key":"ctc","name":"CTC"}] and "userSheetColumns":[{"label":"Staff ID *","value":"STF409"},{"label":"Full Name *","value":"ohn.Doe"},{"label":"Date of Birth *\\n(YYYY-MM-DD)","value":"15-03-2000"},{"label":"Designation *","value":"Systems Analyst-1"},{"label":"Date of Joining *\\n(YYYY-MM-DD)","value":"2019-02-07"},{"label":"Last Working Day *\\n(YYYY-MM-DD)","value":"16-07-2019"},{"label":"Phone Number","value":9876543210},{"label":"Personal Email","value":"Shilpa78@yopmail.com"},{"label":"Business Email","value":"user4@yopmail.com"},{"label":"Employment \\nType","value":"Permanent"},{"label":"Exit Type","value":"Employee Resignation"},{"label":"Exit Reason","value":"Resignation"},{"label":"Eligible for Rehire","value":"Yes"},{"label":"Reporting Manager\'s \\nName","value":"ohn.Doe"},{"label":"Reporting Manager\'s \\nDesignation","value":"CEO/Director"},{"label":"Reporting Manager\'s \\nEmail","value":"user4@yopmail.com"},{"label":"Reporting Manager\'s \\nPhone","value":9876543210},{"label":"CTC","value":600000}] for example: "requiredSheetsColumns": [{"key":"staff_id","name":"Staff ID"}], "userSheetColumns": [{"label":"Ignore","value":"SHRIND201"}] your response should be: [{"key":"staff_id","matched_column":"Staff ID"}]. Please ensure efficient and deatiled match. column names can also be in short like rm for Reporting Manager\'s Name etc. Return only the array and nothing else.'}]} is not of type 'array' - 'messages'
```

## Reason

The 400 Bad Request error occurs because the `messages` parameter in the request body does not conform to the expected JSON schema required by the Azure OpenAI API. Specifically, the API expects the `messages` field to be an array (a list) of objects, but the provided input was a different data type, likely a dictionary or a nested object.

Key reasons for this error include:
1. **Incorrect Data Structure**: The `messages` field must be a JSON array. If the entire request object (containing `userId` and other metadata) is accidentally passed into the `messages` parameter, the validator will fail because it receives a JSON object instead of a list.
2. **Authentication or Authorization Issues**: Invalid, expired, or improperly configured subscription keys or managed identity roles can trigger generic 400 errors.
3. **Content Filtering Policies**: If the content of the prompt triggers Azure OpenAI's safety filters (e.g., hate, violence, or self-harm categories), the API may return a 400 error indicating the response was filtered.
4. **Malformed Resource ID or Endpoint**: Errors in the resource URI, such as an incorrect deployment name or a typo in the endpoint URL, will prevent the request from being processed correctly.
5. **API Version Compatibility**: Using an unsupported or deprecated API version in the query string (e.g., `api-version=2024-02-15-preview`) can lead to schema validation failures if the parameters used are not supported by that specific version.

## Solution
To resolve the 400 status error, you must ensure that your request payload adheres strictly to the Azure OpenAI Chat Completion schema. Follow these remediation steps:
1. **Correct the Messages Array**: Ensure the `messages` field is a flat array of objects. Each object must contain a `role` (system, user, or assistant) and `content`. Remove any wrapper objects such as `userId` from the `messages` array itself.

Correct structure example:
```json
{
  "messages": [
    {"role": "system", "content": "..."},
    {"role": "user", "content": "..."}
  ]
}
```
2. **Verify Authentication**: Check that your `api-key` header contains a valid, active key from the Azure Portal. If using Entra ID (formerly Azure AD), ensure the Bearer token is valid and the calling identity has the 'Cognitive Services OpenAI User' role.
3. **Review Content Filtering**: Check the prompt for potential safety violations. If you suspect a false positive, try rephrasing the input or applying for a modified content filter if your use case allows it.
4. **Validate Endpoint and Deployment**: Verify the URL matches the format: `https://{your-resource-name}.openai.azure.com/openai/deployments/{your-deployment-name}/chat/completions?api-version={api-version}`. Ensure the `{your-deployment-name}` matches the name you gave the model in the Azure AI Studio.
5. **Check API Version**: Use a supported API version. Current stable versions include `2023-05-15` and `2024-06-01`. Ensure the parameters you are using (like `response_format` or `seed`) are compatible with the chosen version.

## Suggested Links
- [https://community.openai.com/t/azure-open-ai-assistant-api-connection-error/662198](https://community.openai.com/t/azure-open-ai-assistant-api-connection-error/662198)
- [https://github.com/FlowiseAI/Flowise/issues/195](https://github.com/FlowiseAI/Flowise/issues/195)
- [https://learn.microsoft.com/en-us/answers/questions/1680345/issue-with-authenticating-api-management-with-azur](https://learn.microsoft.com/en-us/answers/questions/1680345/issue-with-authenticating-api-management-with-azur)
- [https://github.com/explodinggradients/ragas/issues/649](https://github.com/explodinggradients/ragas/issues/649)
- [https://learn.microsoft.com/en-us/answers/questions/2117771/unable-to-perform-http-communication-with-azure-op](https://learn.microsoft.com/en-us/answers/questions/2117771/unable-to-perform-http-communication-with-azure-op)
- [https://cheatsheet.md/chatgpt-cheatsheet/openai-api-error-axioserror-request-failed-status-code-400](https://cheatsheet.md/chatgpt-cheatsheet/openai-api-error-axioserror-request-failed-status-code-400)
- [https://github.com/Azure/azure-sdk-for-java/blob/main/sdk/openai/azure-ai-openai/TROUBLESHOOTING.md](https://github.com/Azure/azure-sdk-for-java/blob/main/sdk/openai/azure-ai-openai/TROUBLESHOOTING.md)
- [https://learn.microsoft.com/en-us/answers/questions/1479386/azure-openai-api-calling-issue](https://learn.microsoft.com/en-us/answers/questions/1479386/azure-openai-api-calling-issue)
- [https://learn.microsoft.com/en-us/azure/ai-services/openai/reference](https://learn.microsoft.com/en-us/azure/ai-services/openai/reference)
