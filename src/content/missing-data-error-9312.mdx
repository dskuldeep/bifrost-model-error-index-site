---
title: "In the second to last message, the tool_calls is not given. (Request ID: c5209b3d-f684-4d17-8296-5907a2ab4e0d)"
provider: "anyscale"
provider_icon: "/file.svg"
solved: true
slug: "missing-data-error-9312"
---

## Reason

This error occurs when the Anyscale API (which follows the OpenAI-compatible schema) receives a message history that is logically inconsistent regarding tool usage. When an `assistant` message includes `tool_calls`, the API strictly requires that the subsequent message(s) provide the results of those calls using the `tool` role. If the sequence is interrupted by a `user` message or another `assistant` message before the tool outputs are provided, the API returns a 400 Bad Request error.

In no-code or low-code environments like Bubble, catching and handling these 400 errors can be achieved through several methods:
1. **Bubble's Built-in Error Handling**: Recent updates allow users to enable the "Include errors in response and allow workflow actions to continue" checkbox in API call settings. This enables workflows to handle errors conditionally using the "returned an error" property.
2. **Nested API Calls**: This approach involves calling the API twice: once with the Data Type set to "Data" and once to "Text". The "Text" response can be inspected for indicators like `[object Object]`, which signifies an error response.
3. **External Middleware**: Utilizing services like Make (formerly Integromat) to wrap the API call allows you to capture the error, handle it externally, and pass a dummy 200 status back to Bubble to ensure the workflow does not break.

## Solution
To resolve the 400 status error and correctly implement tool calls in Anyscale, follow these steps:

**Ensure Correct Request Formatting**
1. Verify that the `tool_calls` object is present in the assistant's message if a tool was invoked.
2. Ensure that for every `tool_call_id` generated by the assistant, there is a corresponding message with the role `tool` and the matching `tool_call_id` in the next position of the messages array.
3. Consult the Anyscale or OpenAI documentation to ensure all query parameters, body fields, and headers are strictly compliant with the schema.

**Validate Request Data**
1. Review the request JSON for syntax errors or missing fields as highlighted in the error message.
2. Ensure that no unsupported fields are included in the API payload, as the schema validation is strict.

**Handle Errors in Workflow**
1. In your application's API settings (such as Bubble's API Connector), enable the option to include errors in the response.
2. Implement conditional logic to monitor for specific error codes or response patterns and trigger appropriate remediation workflows or user-facing alerts.

## Suggested Links
- [https://docs.anyscale.com/endpoints/model-serving/tool-calling/](https://docs.anyscale.com/endpoints/model-serving/tool-calling/)
- [https://platform.openai.com/docs/guides/function-calling](https://platform.openai.com/docs/guides/function-calling)
- [https://manual.bubble.io/core-resources/api/api-connector](https://manual.bubble.io/core-resources/api/api-connector)
