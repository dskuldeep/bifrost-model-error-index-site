---
title: "Invalid schema for function 'getApiQueryParamsForCRMConnectors': In context=('properties', 'email_addresses'), array schema missing items"
provider: "azure-openai"
provider_icon: "/file.svg"
solved: true
slug: "schema-error-9412"
---

## Reason

The **400 Bad Request** error in Azure OpenAI, specifically the "Invalid schema for function" message, occurs when the tool or function definition provided in the API request does not conform to the supported JSON Schema subset. 

Key reasons include:

*   **Missing 'items' Keyword for Arrays**: In JSON Schema, any property defined with `type: "array"` must also include an `items` property to describe the data type of the elements within that array. The error `In context=('properties', 'email_addresses'), array schema missing items` explicitly indicates that the `email_addresses` property is missing this required definition.
*   **Invalid Request Payload**: The JSON structure of the request might be malformed, or it may contain unrecognized fields that do not align with the OpenAI API specification.
*   **Model-Specific Validation**: Azure OpenAI models (such as GPT-4o or GPT-4 Turbo) perform strict validation on function parameters. Definitions that might have been ignored or handled leniently in older models can cause immediate failures in newer versions.
*   **Incorrect Header Configuration**: If the `Content-Type` header is not set to `application/json`, the server may fail to parse the schema correctly, though the specific "missing items" message usually points directly to a structural issue in the JSON body.

## Solution
To resolve the "Invalid schema for function" error, follow these steps to correct your function definition and request structure:
1.  **Add the 'items' Property to Arrays**: Update the schema for the `email_addresses` property (and any other array properties) to include the `items` keyword. 
    
    **Incorrect Example:**
    ```json
    "email_addresses": { "type": "array" }
    ```
    
    **Correct Example:**
    ```json
    "email_addresses": {
      "type": "array",
      "items": {
        "type": "string"
      }
    }
    ```
2.  **Verify the JSON Schema Structure**: Ensure the function's `parameters` object includes the required `type: "object"` and a valid `properties` dictionary. Ensure that all fields listed in the `required` array are actually defined in the `properties` object.
3.  **Validate Model-Specific Requirements**: Check if the model version you are using has specific constraints on schema depth or property count. Ensure you are using a supported API version (e.g., `2023-12-01-preview` or later) for tool calling.
4.  **Confirm Request Headers**: Ensure your request includes the header `Content-Type: application/json`.
5.  **Test with a Schema Validator**: Use an online JSON Schema validator against the OpenAI-supported subset to identify hidden syntax errors or missing required keywords before deploying the code.

## Suggested Links
- [https://cheatsheet.md/chatgpt-cheatsheet/openai-api-error-axioserror-request-failed-status-code-400](https://cheatsheet.md/chatgpt-cheatsheet/openai-api-error-axioserror-request-failed-status-code-400)
- [https://github.com/instructor-ai/instructor/issues/961](https://github.com/instructor-ai/instructor/issues/961)
- [https://learn.microsoft.com/en-us/answers/questions/1479386/azure-openai-api-calling-issue](https://learn.microsoft.com/en-us/answers/questions/1479386/azure-openai-api-calling-issue)
- [https://yourazurecoach.com/2023/05/17/validate-payloads-in-azure-api-management/](https://yourazurecoach.com/2023/05/17/validate-payloads-in-azure-api-management/)
- [https://github.com/Azure/azure-sdk-for-java/blob/main/sdk/openai/azure-ai-openai/TROUBLESHOOTING.md](https://github.com/Azure/azure-sdk-for-java/blob/main/sdk/openai/azure-ai-openai/TROUBLESHOOTING.md)
- [https://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/function-calling](https://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/function-calling)
- [https://json-schema.org/understanding-json-schema/reference/array](https://json-schema.org/understanding-json-schema/reference/array)
