---
title: "Invalid schema for function \"guidance_web_qna\": In context=(\"properties\", \"query_variations\"), array schema missing items"
provider: "azure-openai"
provider_icon: "/file.svg"
solved: true
slug: "schema-validation-error-9417"
---

## Reason

The 400 status error "Invalid schema for function" in the Azure OpenAI API occurs when the JSON Schema provided for a function (tool) definition does not strictly conform to the expected specification. Key reasons include:
1. **Missing Array Items**: The specific error `array schema missing items` indicates that a property defined with `"type": "array"` (in this case, `query_variations`) does not contain the mandatory `"items"` field. In JSON Schema, if you declare a type as an array, you must specify what types of items the array contains.
2. **JSON Schema Version Mismatch**: Azure OpenAI and OpenAI use a specific subset of JSON Schema. While some newer drafts allow keywords like `prefixItems`, the API typically requires the standard `"items"` keyword for array definitions. Using unsupported keywords or omitting required ones leads to validation failure.
3. **Invalid Request Parameters**: Providing parameters that are incompatible with the specific model or API version. For instance, using `max_completion_tokens` (required for the **o1** model series) instead of `max_tokens` (used for GPT-4 and GPT-3.5 models), or vice versa, can trigger a 400 error.
4. **Payload Validation**: The API strictly validates the structure and data types of the payload. Any deviation—such as missing required fields, additional unrecognized properties, or nested `anyOf` blocks that the parser cannot resolve—will result in a schema error.
5. **Header or Content-Type Issues**: If the `Content-Type` header is not set to `application/json` or if authentication headers are improperly formatted, the server may reject the request before schema processing is complete.

## Solution
To resolve the "Invalid schema for function" error, follow these remediation steps:
1. **Update the Array Schema**: Locate the `query_variations` property in your function definition and ensure it includes the `"items"` field. A valid schema should look like this:

   ```json
   "query_variations": {
     "type": "array",
     "items": {
       "type": "string"
     }
   }
   ```
2. **Verify Request Parameters**: Use the parameters specific to the model you have deployed:

   * Use `max_tokens` for GPT-4, GPT-4o, and GPT-3.5 models.
   * Use `max_completion_tokens` specifically for the **o1-preview** and **o1-mini** models.
3. **Validate the Payload**: Ensure the JSON structure matches the function definition exactly. Check for common issues like:

   * Missing required parameters in the `"required"` array.
   * Using `"type": "object"` for fields that are being passed as strings.
   * Incorrectly nested properties within the `"parameters"` block.
4. **Confirm Headers**: Verify that your request includes the following header:

   * `Content-Type: application/json`
5. **Review API Documentation**: Ensure you are using a supported API version (e.g., `2023-07-01-preview` or later) that supports function calling and tools. Refer to the Azure OpenAI documentation to confirm the exact schema requirements for the `guidance_web_qna` function if it is a pre-defined or system-level tool.

## Suggested Links
- [https://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/function-calling](https://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/function-calling)
- [https://json-schema.org/understanding-json-schema/reference/array](https://json-schema.org/understanding-json-schema/reference/array)
- [https://platform.openai.com/docs/guides/function-calling](https://platform.openai.com/docs/guides/function-calling)
