---
title: "rayllm.backend.llm.error_handling.ValidationError: top_p must be 1 when using greedy sampling. (Request ID: 82f41f76-a592-4d89-a6c5-e36ab8ce9d7b)"
provider: "anyscale"
provider_icon: "/file.svg"
solved: true
slug: "validation-error-9513"
---

## Reason

The error `rayllm.backend.llm.error_handling.ValidationError: top_p must be 1 when using greedy sampling` occurs when an API request contains conflicting sampling parameters. This is categorized as a 400 Bad Request client error.

In the Anyscale API (and the underlying RayLLM backend), **greedy sampling** is typically activated when the `temperature` parameter is set to `0`. Greedy sampling works by selecting only the single most probable token at each step. Because this method does not sample from a distribution of tokens, the `top_p` parameter (nucleus sampling), which defines a cumulative probability threshold, must be set to `1` (representing the full distribution). Providing any other value for `top_p` while in greedy mode creates a logical mismatch in the sampling configuration, leading to this validation failure.

## Solution
To resolve this validation error and successfully make the API call, you must ensure your request configuration follows these rules:
1. **Set top_p to 1 for Greedy Sampling**: If your request uses greedy sampling (typically by setting `temperature` to `0`), you must explicitly set the `top_p` parameter to `1` or omit it if the default is `1`.
2. **Enable Sampling for custom top_p values**: If you intend to use a specific `top_p` value (e.g., `0.9`), ensure that the `temperature` is set to a value greater than `0` to enable non-greedy sampling.
3. **Audit API Parameters**: Review the entire request payload to ensure all parameters are correctly configured according to the Anyscale API requirements. Double-check that there are no extra, unsupported, or redundant fields that might conflict with the sampling logic.
4. **Verify Request ID**: If the error persists, use the `Request ID` provided in the error message (e.g., `82f41f76-a592-4d89-a6c5-e36ab8ce9d7b`) when contacting support to help identify specific backend validation failures.

## Suggested Links
- [https://docs.anyscale.com/endpoints/model-serving/parameters](https://docs.anyscale.com/endpoints/model-serving/parameters)
