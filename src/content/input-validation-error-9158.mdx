---
title: "Invalid value for 'tool_choice': 'tool_choice' is only allowed when 'tools' are specified."
provider: "azure-openai"
provider_icon: "/file.svg"
solved: true
slug: "input-validation-error-9158"
---

## Reason

The HTTP 400 error occurs in the Azure OpenAI Chat Completion API because the `tool_choice` parameter is provided in the request body while the `tools` array is either missing, null, or empty. 

Key reasons for this failure include:
1. Parameter Dependency: The `tool_choice` parameter serves as a directive to control how the model interacts with the tools available. If the `tools` field is not specified, the API cannot process instructions on how to select or force a tool.
2. Validation Rules: The API schema requires that whenever a logic modifier like `tool_choice` is present, the corresponding data source (the `tools` array) must also be present to provide context.
3. Request Mismatch: This error indicates a structural mismatch where the developer is attempting to configure tool behavior without defining the actual functions or tools the model is supposed to use.

## Solution
To resolve the 400 status error, you must ensure that your API request includes both the `tools` definition and a valid `tool_choice` configuration. Follow these steps:
1. Include the `tools` Field: Add the `tools` array to your request body. This field should contain an array of objects defining the functions the model can call.
2. Define Tool Details: Ensure each object in the `tools` array is correctly structured, typically including `type: "function"` and a `function` object with a `name`, `description`, and `parameters` schema.
3. Verify tool_choice Compatibility: If you set `tool_choice` to a specific function object (e.g., `{"type": "function", "function": {"name": "my_function"}}`), ensure that the name matches a function defined in your `tools` array.
4. Check API Version: Use a modern API version (such as `2023-12-01-preview` or later) that supports the `tools` parameter. Older versions using the deprecated `functions` parameter will not recognize `tool_choice` correctly.
5. Adjust for Default Behavior: If you do not want to use tools for a specific request, remove the `tool_choice` parameter entirely or set it to `"none"` (though setting it to `"none"` still typically requires the `tools` array to be defined in many API versions).

## Suggested Links
- [https://community.openai.com/t/new-tool-choice-as-required-is-not-available-on-azure/740735](https://community.openai.com/t/new-tool-choice-as-required-is-not-available-on-azure/740735)
- [https://learn.microsoft.com/en-us/answers/questions/2032017/tool-choice-required-sometimes-not-supported-in-az](https://learn.microsoft.com/en-us/answers/questions/2032017/tool-choice-required-sometimes-not-supported-in-az)
- [https://cheatsheet.md/chatgpt-cheatsheet/openai-api-error-axioserror-request-failed-status-code-400](https://cheatsheet.md/chatgpt-cheatsheet/openai-api-error-axioserror-request-failed-status-code-400)
- [https://learn.microsoft.com/en-us/answers/questions/1690891/support-for-tool-choice-required-in-azure-openai-s](https://learn.microsoft.com/en-us/answers/questions/1690891/support-for-tool-choice-required-in-azure-openai-s)
- [https://github.com/Azure/azure-rest-api-specs/issues/29844](https://github.com/Azure/azure-rest-api-specs/issues/29844)
- [https://bobcares.com/blog/azure-openai-invalid_request_error/](https://bobcares.com/blog/azure-openai-invalid_request_error/)
- [https://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/function-calling](https://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/function-calling)
- [https://platform.openai.com/docs/guides/function-calling](https://platform.openai.com/docs/guides/function-calling)
