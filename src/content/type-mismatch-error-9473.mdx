---
title: "The input provided is not of the expected type \"array\". Ensure the structure of the data matches the required format."
provider: "azure-openai"
provider_icon: "/file.svg"
solved: true
slug: "type-mismatch-error-9473"
---

## Raw Error Text

```text
{"description": "The "guidance_web_qna" function is designed to generate relevant maximum 20 FAQs related to a business from scrapped information passed as text and It can be used to reply to customers when they ask generic questions. In this function we create queries and answers and variations for each question", "parameters": {"type": "object", "properties": {"query_arr": {"type": "array", "description": "The "query_arr" parameter represents the list of question or request that will be sent to the API. It should be structured to ask generic questions about business limited to 150 characters", "items": {"type": "object", "properties": {"query_item": {"description": "the "query_item" is for single question", "type": "string"}, "answer": {"type": "string", "description": "The "answer" parameter represents the actual answer of the business present in the context which is scrapped textual data"}, "query_variations": {"type": "array", "description": "The "query_variations" parameter represents the list of variations  of query_item formed above so as to cover various cases when an actual customer of the business asks questions. for example if query_item is Where is my order?, query_variations would be What is status of my order or where did my order reach or can you tell me where is my order or can you help track my order or is my order dispatched etc", "items": {"type": "object", "properties": {"variation": {"type": "string", "description": "The "variation" parameter represents the unique variation of the query_item formed above"}}}}}}}, "context_not_enough": {"type": "string", "description": "The "context_not_enough" parameter is the string response only with allowed values true or false and return true from assistant in case the atleast relevant 1 FAQ is not formed from the context passed"}}}} is not of type "array" - "functions"
```

## Reason

This error occurs primarily because the Azure OpenAI API expects the `functions` parameter in the request payload to be an array of objects. The raw error message indicates that a single object (the definition for `guidance_web_qna`) was passed directly to a field expecting an array. 

Additional factors contributing to 400-level errors in Azure OpenAI include:
1. **Invalid Request Payload**: The data structure does not match the expected JSON schema. This includes using incorrect data types (e.g., providing a string where an array is expected) or missing required fields within parameters like `query_arr`.
2. **Incorrect API Keys or Credentials**: The API key may be invalid, expired, or improperly configured in the request headers.
3. **Incorrect API Endpoint or Headers**: The base URL, deployment name, or mandatory headers (such as `api-key` or `Content-Type`) may be incorrectly specified.
4. **Rate Limiting and Throttling**: Requests exceeding the TPM (Tokens Per Minute) or RPM (Requests Per Minute) quotas assigned to the deployment.
5. **Unrecognized Request Arguments**: Including parameters that are not supported by the specific model version or the selected API version.
6. **Input Validation Errors**: Data exceeding character limits (e.g., the 150-character limit mentioned in the `query_arr` description) or failing to match specific format requirements.
7. **Network and Firewall Issues**: Corporate firewalls or network security groups may be intercepting or blocking outbound requests to the Azure OpenAI service endpoints.

## Solution
To resolve the type mismatch and general 400 errors, follow these remediation steps:
1. **Correct Request Payload Structure**: Ensure the `functions` parameter is defined as an array, even if you are only passing one function. For example: `"functions": [{ "name": "guidance_web_qna", ... }]`.
2. **Verify Nested Arrays**: Check that the `query_arr` and `query_variations` parameters are also passed as arrays in the actual API call, as defined in your schema.
3. **Verify API Keys and Credentials**: Double-check that your Azure OpenAI API key is valid and correctly placed in the `api-key` header.
4. **Check API Endpoint and Headers**: Confirm the endpoint URL follows the format: `https://{resource-name}.openai.azure.com/openai/deployments/{deployment-id}/chat/completions?api-version={api-version}`.
5. **Adhere to Rate Limits**: Implement exponential backoff or request queuing to stay within your subscription's rate limits.
6. **Remove Unrecognized Arguments**: If you are using newer models, consider transitioning from the deprecated `functions` parameter to the `tools` parameter, and ensure no unsupported legacy fields are present.
7. **Validate Input Data**: Ensure the text passed for processing does not exceed the token limits of the model or the specific character constraints defined in your function parameters.
8. **Inspect Network and Firewall Settings**: Ensure that the environment where the code is running has permission to reach `*.openai.azure.com` over port 443.

## Suggested Links
- [https://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/function-calling](https://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/function-calling)
- [https://learn.microsoft.com/en-us/azure/ai-services/openai/reference](https://learn.microsoft.com/en-us/azure/ai-services/openai/reference)
