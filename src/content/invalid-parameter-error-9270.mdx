---
title: "Invalid parameter: messages with role \"tool\" must be a response to a preceeding message with \"tool_calls\"."
provider: "openai"
provider_icon: "/logos/openai.svg"
solved: true
slug: "invalid-parameter-error-9270"
---

## Reason

This 400 Bad Request error occurs when the OpenAI API detects an invalid sequence in the conversation history. Specifically, the API requires a strict conversational flow when using tool or function calling. 

A message with the role `tool` is intended to provide the output of a function that the model previously requested to run. Therefore, the API expects any `tool` message to be immediately preceded by an assistant message containing a `tool_calls` array. If this preceding message is missing, incorrectly formatted, or if the sequence is interrupted by a message that does not trigger a tool response, the API cannot associate the tool output with a specific request, leading to this error.

## Solution
To resolve this error, you must ensure your request follows the required message structure for tool calls. Follow these steps:
1. **Verify Message Sequence**: Ensure that every message with the role `tool` is preceded by an assistant message (`role: "assistant"`) that contains the `tool_calls` property.
2. **Match Tool Call IDs**: Each tool message must include a `tool_call_id`. This ID must match the `id` provided in the `tool_calls` object of the preceding assistant message.
3. **Maintain Thread Integrity**: Avoid sending tool messages in isolation. If you are reconstructing a conversation from a database, ensure you are not skipping the assistant message that originally initiated the tool call.
4. **Check for Empty Tool Calls**: Ensure the assistant message actually contains one or more valid tool call objects before appending the tool response.
5. **Validate Role Names**: Ensure you are using the correct role identifier `tool` (and not `function`, which is part of the deprecated function-calling API) when using the `tool_calls` flow.

## Suggested Links
- [Redacted URL](Redacted URL)
- [Redacted URL](Redacted URL)
