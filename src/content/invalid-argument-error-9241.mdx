---
title: "Invalid response recieved from google: [{\"error\":{\"code\":400,\"message\":\"Please ensure that multiturn requests alternate between user and model.\",\"status\":\"INVALID_ARGUMENT\"}}]"
provider: "google"
provider_icon: "/logos/google.png"
solved: true
slug: "invalid-argument-error-9241"
---

## Reason

The `400 Bad Request` error with the status `INVALID_ARGUMENT` occurs when the conversation history in a Google Gemini API request does not follow the required alternating structure. 

Key rules for the conversation history include:
1. **Strict Alternation**: The API requires a sequence where each message (turn) alternates between the `user` and `model` roles. You cannot have two consecutive turns from the same role (e.g., `user` followed by `user`).
2. **Start Role**: A conversation history must typically begin with a `user` turn. Starting a sequence with a `model` turn will trigger this error.
3. **Role Property**: Every object in the `contents` array must have a `role` property explicitly set to either `"user"` or `"model"`.
4. **Message Sequencing**: The API rejects requests where the client fails to maintain the correct sequential order of a dialogue, which is necessary for the model to process the context of multi-turn conversations.

## Solution
To resolve the `400 Bad Request` error and ensure your multi-turn requests are processed correctly, follow these implementation steps:
1. **Verify and Fix Alternating Turns**: Audit your message history array to ensure every `user` message is followed by a `model` message. If you have multiple consecutive messages from the same role, merge them into a single turn with multiple `parts` or remove the duplicates.
2. **Validate the Starting Turn**: Ensure that the very first object in your `contents` or history array is assigned the `user` role.
3. **Standardize Role Assignment**: Double-check that all turns use the exact strings `"user"` and `"model"`. Note that the Gemini API is case-sensitive regarding these identifiers.
4. **Correct Tool/Function Integration**: If your conversation involves Function Calling, ensure the flow follows the pattern: `user` -> `model` (including a `function_call` part) -> `function_response` turn. In some SDKs, the function response must be provided in a specific turn that maintains the alternating flow.
5. **Use SDK Chat Sessions**: If possible, use the official Google Generative AI SDKs (e.g., `startChat` in Python or Node.js). These libraries manage the state and role alternation automatically, reducing the risk of manual formatting errors.
6. **Check Model Compatibility**: Ensure you are using a model that supports multi-turn chat (such as `gemini-1.5-flash` or `gemini-1.5-pro`). Older vision-specific models may not support multi-turn history in the same format.

## Suggested Links
- [https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400)
- [https://www.hostinger.com/tutorials/how-to-fix-400-bad-request-error](https://www.hostinger.com/tutorials/how-to-fix-400-bad-request-error)
- [https://www.googlecloudcommunity.com/gc/Workspace-Q-A/Seeing-400-error-while-trying-to-send-a-mail/m-p/536255](https://www.googlecloudcommunity.com/gc/Workspace-Q-A/Seeing-400-error-while-trying-to-send-a-mail/m-p/536255)
- [https://community.make.com/t/error-400-the-requested-conversion-is-not-supported/25618](https://community.make.com/t/error-400-the-requested-conversion-is-not-supported/25618)
- [https://developers.google.com/gmail/api/guides/handle-errors](https://developers.google.com/gmail/api/guides/handle-errors)
- [https://github.com/googleapis/nodejs-vertexai/issues/139](https://github.com/googleapis/nodejs-vertexai/issues/139)
- [https://www.googlecloudcommunity.com/gc/AI-ML/Gemini-s-safety-config-400-error-from-today/m-p/712366](https://www.googlecloudcommunity.com/gc/AI-ML/Gemini-s-safety-config-400-error-from-today/m-p/712366)
- [https://developers.google.com/drive/api/guides/handle-errors](https://developers.google.com/drive/api/guides/handle-errors)
- [https://ai.google.dev/gemini-api/docs/troubleshooting](https://ai.google.dev/gemini-api/docs/troubleshooting)
- [https://cloud.google.com/monitoring/api/troubleshooting](https://cloud.google.com/monitoring/api/troubleshooting)
- [https://ai.google.dev/gemini-api/docs/text-generation#chat](https://ai.google.dev/gemini-api/docs/text-generation#chat)
- [https://ai.google.dev/gemini-api/docs/function-calling](https://ai.google.dev/gemini-api/docs/function-calling)
- [https://cloud.google.com/vertex-ai/docs/generative-ai/model-reference/gemini](https://cloud.google.com/vertex-ai/docs/generative-ai/model-reference/gemini)
